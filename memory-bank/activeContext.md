# Active Context

## Состояние
- Vite + React структура развернута, Tailwind/React Query/Zustand подключены, есть базовый дашборд-плейсхолдер.
- Supabase CLI связан, Docker настроен, выполнен `db pull`.
- Схема БД разработана, миграция `20251115124215_20251115_init_schema.sql` задеплоена (enum, таблицы, индексы, RLS).
- Виджет привычек теперь содержит счётчики успехов/провалов (inline-редакторы, скрытие fail при 0, подсветка галочки, если успехи сегодня не обновлялись).
- Интерфейс виджета привычек упрощён: осталась только скроллируемая область и поле добавления, высота списка регулируется drag-хэндлами на границах вместо отдельных кнопок.

## В работе
- Supabase auth подключён (AuthProvider + AuthButton), есть юнит-тесты на UI.
- Реализованы bootstrap дашборда/виджетов и API/хуки для `habits` + `layout`.
- Ведём работу над расширенным виджетом микрозадач: таймеры уже есть, теперь добавлены теги/категории и буфер наследования (popover-менеджер + попап на карточке).
- UI таксономии микрозадач отполирован: автокатегории скрыты из менеджера, выпадающие списки заменены кастомным тёмным combobox на базе Floating UI.
- Добавлен архив микрозадач: колонка `archived_at`, кнопка «Архив» для завершённых задач, хук `useArchiveMicroTask`, фильтрация в API и тесты.
- Таймеры микрозадач можно редактировать вручную: клик по времени открывает inline-инпут `HH:MM:SS`, значение валидируется/сохраняется через `updateMicroTask`.
- Категории получили цвета (6 пресетов); выбор цвета хранится в БД, влияет на чипы и иконки тегов, кнопка цвета в менеджере открывает палитру и работает через оптимистичное обновление. Авто-категории отображаются, но остаются только для чтения.

## Следующие шаги
1. Завершить UX остальных виджетов (problems/tasks/images) с сохранением в Supabase.
2. Подготовить интеграционные тесты/MSW для новых RPC (reorder, tags/categories).
3. Отшлифовать drag-and-drop layout и smoke-сценарии перед деплоем.

